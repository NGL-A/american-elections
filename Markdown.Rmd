---
title: "Elections, COVID and Demographic Data"
author: "Bissacco, Sartori, Sboarina"
date: "27/5/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Elections, COVID and Demographic Data



Every 4 year one of the most relevant political events in the world takes place: the election of the US President. After months, even years, of preparations (campaigns, public speeches, sponsors...) the eyes of the entire world are looking to the results of those elections, to the one who will be leading the "free world" in the near future.

Our project wants to focus on what might affect one's vote: if the geographical area is relevant, if the type of work can change the preference, if one ethnicity is more likely to vote a Party over the other and if there is any strong correlation between the variables.  
We found our dataset on [Kaggle](https://www.kaggle.com/datasets/etsc9287/2020-general-election-polls). It contains 2017 demographic and economic situation of each American county, the numbers of 2016 and 2020 US Elections and COVID report until 1st November 2020 (few days before the elections).


Since it had many NA values (the names of some counties changed name) we started by cleaning our dataset from these.

```{r, results='hide'}
data_uncleaned <- read.csv("county_statistics.csv", sep = ",", header = TRUE)
data <- na.omit(data_uncleaned)
attach(data)
```

And we also decided which between our 51 variables we didn't need. We deleted [...] columns (because... ?) and maintained:  
1. County: chchg
2. State: Two-Letter State Abbreviation
3. s: sdsd  
4. fmfle: fowneownefo


- X index from 0 to 4.867
- County County or county equivalent 
- ID State State, DC, or Puerto Rico 
- percentage16_Donald_Trump percentage of votes Donald Trump got in 2016
- percentage16_Hillary_Clinton percentage of votes Hilary CLinton got in 2016
- total_votes16 total number of votes from 2016
- votes16_Donald_Trump number of votes Donald Trump got in 2016
- votes16_Hillary_Clinton number of votes Hilary CLinton got in 2016
- percentage20_Donald_Trump percentage of votes Donald Trump got in 2020
- percentage20_Joe_Biden percentage of votes Joe Biden got in 2020
- total_votes20 total number of votes from 2020
- votes20_Donald_Trump number of votes Donald Trump got in 2020
- votes20_Joe_Biden number of votes Joe Biden got in 2020
- lat latitude coordinates
- long longitude coordinates
- cases Covid19 cases
- deaths Covid19 deaths
- TotalPop Total population 
- Men number of men 
- Women number of women 
- Hispanic percent of population that is Hispanic/Latino 
- White percent of population that is white 
- Black percent of population that is black 
- Native percent of population that is Native American or Native Alaskan 
- Asian percent of population that is Asian 
- Pacific percent of population that is Native Hawaiian or Pacific Islander 
- VotingAgeeCitizen number of citizens above voting age
- Income Median household income 
- IncomeErr Median household income error 
- IncomePerCap Income per capita 
- IncomePerCapErr Income per capita error 
- Poverty percent under poverty level 
- ChildPoverty percent of children under poverty level 
- Professional percent employed in management, business, science, and arts 
- Service percent employed in service jobs 
- Office percent employed in sales and office jobs 
- Construction percent employed in natural resources, construction, and maintenance 
- Production percent employed in production, transportation, and material movement 
- Drive percent commuting alone in a car, van, or truck 
- Carpool percent carpooling in a car, van, or truck 
- Transit percent commuting on public transportation 
- Walk percent walking to work OtherTransp percent commuting via other means 
- WorkAtHome percent working at home 
- MeanCommute Mean commute time (minutes) 
- Employed percent employed (16+) 
- PrivateWork percent employed in private industry 
- PublicWork percent employed in public jobs 
- SelfEmployed percent self-employed 
- FamilyWork percent in unpaid family work 
- Unemployment Unemployment rate (percent)


I'll declare our variables (if % or what - and if we turned % in [0, 1]...)...

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:


## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

```{r, results='hide', warning=FALSE, message= FALSE}
library(tidyverse)
library(maps)
library(png)
library(grid)
library(cowplot)
library(statebins)
library(DT)
library(gRbase)
library(magick)
library(ISLR2)
library(leaps)

v<-c(data$percentage20_Donald_Trump<0.5)
regfit.full <- regsubsets(v~., data=data[,-1:-13], really.big = T,nvmax = 38)
reg.summary <- summary(regfit.full)
reg.summary$outmat
reg.summary$rsq
par(mfrow=c(2,2))
plot(reg.summary$rss,xlab="Number of Variables",ylab="RSS",type="l")
plot(reg.summary$adjr2,xlab="Number of Variables",ylab="Adjusted Rsq",type="l")
which.max(reg.summary$adjr2)
points(11,reg.summary$adjr2[11], col="red",cex=2,pch=20)


# Mallow's Cp with its smallest value
plot(reg.summary$cp,xlab="Number of Variables",ylab="Cp",type='l')
which.min(reg.summary$cp)
points(10,reg.summary$cp[10],col="red",cex=2,pch=20)

# BIC with its smallest value
plot(reg.summary$bic,xlab="Number of Variables",ylab="BIC",type='l')
which.min(reg.summary$bic)
points(6,reg.summary$bic[6],col="red",cex=2,pch=20)

par(mfrow=c(1,1))


par(mfrow=c(2,2))
plot(regfit.full,scale="r2")
plot(regfit.full,scale="adjr2")
plot(regfit.full,scale="Cp")

plot(regfit.full,scale="bic")
coef(regfit.full,6)
par(mfrow=c(1,1))




options(repr.plot.width = 17, repr.plot.height = 9)

# US MAP 
usa <- map_data("state")
ggplot(usa, aes(x = long, y = lat, group = group)) +
  geom_polygon(fill="lightgray", colour = "white")

abb <- data.frame(state = state.name, Abb = state.abb)
abb2<-abb
abb2$state<-tolower(abb2$state)
# TOTAL VOTES
election <- data %>% 
  group_by(state) %>% 
  summarise(votes16_Hillary_Clinton = sum(votes16_Hillary_Clinton),
            votes16_Donald_Trump = sum(votes16_Donald_Trump)) %>% 
  ungroup() %>% 
  gather(Candidate, Votes, -state) %>% 
  mutate(Party = factor(if_else(Candidate == "votes16_Hillary_Clinton", "Democrat", "Republican"))) %>% 
  left_join(abb2) %>% 
  #mutate(state = tolower(state)) %>% 
  rename("region" = state)

election2 <- election %>% 
  group_by(region, Abb) %>% 
  summarise(Votes = max(Votes)) %>% 
  ungroup() %>% 
  inner_join(election)




election2<-election2[,-2]

colnames(abb2)[1]<-"region"
colnames(election2)[1]<-"Abb"
election3<-left_join(election2,abb2)
# Left Join for creating map
usa_election <- left_join(usa, election3) %>% 
  filter(!is.na(Party))

ggplot(usa, aes(x = long, y = lat, group = group)) +
  geom_polygon(fill="lightgray", colour = "white")

# First Map
p<-ggplot(data = usa_election, aes(x = long, y = lat),color = usa_election$Party)+
  geom_polygon(aes(group = group, fill = Party),color = "gray90", size = 0.1) +
  coord_map(projection = "albers", lat0 = 39, lat1 = 45) 
p
colnames(data)


plot(Hispanic)
hist(Income[percentage20_Donald_Trump>0.5])
hist(Income[percentage20_Donald_Trump<0.5])

q=c(percentage20_Joe_Biden>0.5)

ggplot(data,aes(x=long,group=q,fill=q))+
  geom_histogram(position="dodge",binwidth=0.25)+theme_bw()

ggplot(data,aes(x=data$Asian, group=q,fill=q))+
  geom_histogram(position="identity",alpha=0.5,binwidth=1)+theme_bw()
```
