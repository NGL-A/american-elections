---
title: "Elections, COVID and Demographic Data"
author: "Bissacco, Sartori, Sboarina"
date: "27/5/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Elections, COVID and Demographic Data

Every 4 year one of the most relevant political events in the world takes place: the election of the US President. It is much more than just a day, there are months and months of preparations (campaigns, public speeches, spornsors...).

I'll declare our variables (if % or what - and if we turned % in [0, 1]...)
Where we found our data

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

```{r}
data_uncleaned <- read.csv("county_statistics.csv", sep = ",", header = TRUE)
data <- na.omit(data_uncleaned)
attach(data)
#View(data)
rownames(data) <- 1:nrow(data)
plot(percentage20_Donald_Trump, lat)
hist(lat[votes20_Donald_Trump], freq = TRUE)
lines(density(lat[votes20_Donald_Trump]))

library(tidyverse)
library(maps)
#install.packages("mapproj")
library(png)
library(grid)
library(cowplot)
library(statebins)
library(DT)


library(gRbase)
library(ISLR2)
library(leaps)

v<-c(data$percentage20_Donald_Trump<0.5)
regfit.full <- regsubsets(v~., data=data[,-1:-13], really.big = T,nvmax = 38)
reg.summary <- summary(regfit.full)
reg.summary$outmat
reg.summary$rsq
par(mfrow=c(2,2))
plot(reg.summary$rss,xlab="Number of Variables",ylab="RSS",type="l")
plot(reg.summary$adjr2,xlab="Number of Variables",ylab="Adjusted Rsq",type="l")
which.max(reg.summary$adjr2)
points(11,reg.summary$adjr2[11], col="red",cex=2,pch=20)


# Mallow's Cp with its smallest value
plot(reg.summary$cp,xlab="Number of Variables",ylab="Cp",type='l')
which.min(reg.summary$cp)
points(10,reg.summary$cp[10],col="red",cex=2,pch=20)

# BIC with its smallest value
plot(reg.summary$bic,xlab="Number of Variables",ylab="BIC",type='l')
which.min(reg.summary$bic)
points(6,reg.summary$bic[6],col="red",cex=2,pch=20)

par(mfrow=c(1,1))


par(mfrow=c(2,2))
plot(regfit.full,scale="r2")
plot(regfit.full,scale="adjr2")
plot(regfit.full,scale="Cp")

plot(regfit.full,scale="bic")
coef(regfit.full,6)
par(mfrow=c(1,1))




options(repr.plot.width = 17, repr.plot.height = 9)

# US MAP 
usa <- map_data("state")
ggplot(usa, aes(x = long, y = lat, group = group)) +
  geom_polygon(fill="lightgray", colour = "white")

abb <- data.frame(state = state.name, Abb = state.abb)
abb2<-abb
abb2$state<-tolower(abb2$state)
# TOTAL VOTES
election <- data %>% 
  group_by(state) %>% 
  summarise(votes16_Hillary_Clinton = sum(votes16_Hillary_Clinton),
            votes16_Donald_Trump = sum(votes16_Donald_Trump)) %>% 
  ungroup() %>% 
  gather(Candidate, Votes, -state) %>% 
  mutate(Party = factor(if_else(Candidate == "votes16_Hillary_Clinton", "Democrat", "Republican"))) %>% 
  left_join(abb2) %>% 
  #mutate(state = tolower(state)) %>% 
  rename("region" = state)

election2 <- election %>% 
  group_by(region, Abb) %>% 
  summarise(Votes = max(Votes)) %>% 
  ungroup() %>% 
  inner_join(election)




election2<-election2[,-2]

colnames(abb2)[1]<-"region"
colnames(election2)[1]<-"Abb"
election3<-left_join(election2,abb2)
# Left Join for creating map
usa_election <- left_join(usa, election3) %>% 
  filter(!is.na(Party))

ggplot(usa, aes(x = long, y = lat, group = group)) +
  geom_polygon(fill="lightgray", colour = "white")

# First Map
p<-ggplot(data = usa_election, aes(x = long, y = lat),color = usa_election$Party)+
  geom_polygon(aes(group = group, fill = Party),color = "gray90", size = 0.1) +
  coord_map(projection = "albers", lat0 = 39, lat1 = 45) 
p
colnames(data)


plot(Hispanic)
hist(Income[percentage20_Donald_Trump>0.5])
hist(Income[percentage20_Donald_Trump<0.5])

q=c(percentage20_Joe_Biden>0.5)

ggplot(data,aes(x=long,group=q,fill=q))+
  +     geom_histogram(position="dodge",binwidth=0.25)+theme_bw()

ggplot(data,aes(x=data$Asian, group=q,fill=q))+
  geom_histogram(position="identity",alpha=0.5,binwidth=1)+theme_bw()
```

