---
title: "Elections, COVID and Demographic Data"
author: "Bissacco, Sartori, Sboarina"
date: "27/5/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Elections, COVID and Demographic Data



Every 4 year one of the most relevant political events in the world takes place: the election of the US President. After months, even years, of preparations (campaigns, public speeches, sponsors...) the eyes of the entire world are looking to the results of those elections, to the one who will be leading the "free world" in the near future.

Our project wants to focus on what might affect one's vote: if the geographical area is relevant, if the type of work can change the preference, if one ethnicity is more likely to vote a Party over the other and if there is any strong correlation between the variables.  
We found our dataset on [Kaggle](https://www.kaggle.com/datasets/etsc9287/2020-general-election-polls). It contains 2017 demographic and economic situation of each American county, the numbers of 2016 and 2020 US Elections and COVID report until 1st November 2020 (few days before the elections).


Since it had many NA values (some counties changed name) we started by cleaning our dataset from these (we went from 4867 to 3046) and we actually got nearly to the real number of US counties which is 3142.

```{r, results='hide'}
data_uncleaned <- read.csv("county_statistics.csv", sep = ",", header = TRUE)
data <- na.omit(data_uncleaned)
attach(data)
```


And we also decided which between our 51 variables we didn't need. We deleted [...] columns (because... ?) and maintained:  
&ensp;&ensp;1. County: county name  
&ensp;&ensp;2. State: Two-Letter State Abbreviation  
&ensp;&ensp;3. percentage16_Donald_Trump: percentage of votes Donald Trump got in 2016  
&ensp;&ensp;4. percentage16_Hillary_Clinton: percentage of votes Hilary Clinton got in 2016  
&ensp;&ensp;5. total_votes16: total number of votes in 2016  
&ensp;&ensp;6. votes16_Donald_Trump: number of votes Donald Trump got in 2016  
&ensp;&ensp;7. votes16_Hillary_Clinton: number of votes Hilary Clinton got in 2016  
&ensp;&ensp;8. percentage20_Donald_Trump: percentage of votes Donald Trump got in 2020  
&ensp;&ensp;9. percentage20_Joe_Biden: percentage of votes Joe Biden got in 2020  
&ensp;&ensp;10. total_votes20: total number of votes in 2020  
&ensp;&ensp;11. votes20_Donald_Trump: number of votes Donald Trump got in 2020  
&ensp;&ensp;12. votes20_Joe_Biden: number of votes Joe Biden got in 2020  
&ensp;&ensp;13. lat: latitude coordinates  
&ensp;&ensp;14. long: longitude coordinates  
&ensp;&ensp;15. cases: COVID-19 cases  
&ensp;&ensp;16. deaths: COVID-19 deaths  
&ensp;&ensp;17. TotalPop: Total population  
&ensp;&ensp;18. Men: number of men  
&ensp;&ensp;19. Women: number of women  
&ensp;&ensp;20. Hispanic: percent of population that is Hispanic/Latino  
&ensp;&ensp;21. White: percent of population that is white  
&ensp;&ensp;22. Black: percent of population that is black  
&ensp;&ensp;23. Native: percent of population that is Native American or Native Alaskan  
&ensp;&ensp;24. Asian: percent of population that is Asian  
&ensp;&ensp;25. Pacific: percent of population that is Native Hawaiian or Pacific Islander  
&ensp;&ensp;26. VotingAgeCitizen: number of citizens above voting age  
&ensp;&ensp;27. Income: median household income  
&ensp;&ensp;28. IncomeErr: median household income error  
&ensp;&ensp;29. IncomePerCap: income per capita  
&ensp;&ensp;30. IncomePerCapErr: income per capita error  
&ensp;&ensp;31. Poverty: percent of population under poverty level  
&ensp;&ensp;32. ChildPoverty percent of children under poverty level  
&ensp;&ensp;33. Professional: percent of population employed in management, business, science and arts  
&ensp;&ensp;34. Service: percent of population employed in service jobs  
&ensp;&ensp;35. Office: percent of population employed in sales and office jobs  
&ensp;&ensp;36. Construction: percent of population employed in natural resources, construction and maintenance  
&ensp;&ensp;37. Production: percent of population employed in production, transportation and material movement  
&ensp;&ensp;38. WorkAtHome: percent of population working at home  
&ensp;&ensp;39. Employed: percent of population employed (16+)  
&ensp;&ensp;40. PrivateWork: percent of population employed in private industry  
&ensp;&ensp;41. PublicWork: percent of population employed in public jobs  
&ensp;&ensp;42. SelfEmployed: percent of population self-employed  
&ensp;&ensp;43. FamilyWork: percent of population in unpaid family work  
&ensp;&ensp;44. Unemployment: unemployment rate (percent)  

```{r}
#Codice in cui tolgo le variabili inutili
```
&ensp;&ensp;  

  
I'll declare we turned % in [0, 1]...

```{r}
#Cambio le colonne da % a relativo
```
&ensp;&ensp;  


I'll add two new column with the winner of '16, '20 elections in each state.

```{r}
#Aggiungo colonne
```
&ensp;&ensp;  

Here I think we finished to clean our data.


## Maps

```{r, results='hide', warning=FALSE, message= FALSE}
library(tidyverse)
library(maps)
library(png)
library(grid)
library(cowplot)
library(statebins)
library(DT)
library(gRbase)
library(magick)
library(ISLR2)
library(leaps)

#Metti mappa
```



```{r, results='hide', warning=FALSE, message= FALSE}
library(tidyverse)
library(maps)
library(png)
library(grid)
library(cowplot)
library(statebins)
library(DT)
library(gRbase)
library(magick)
library(ISLR2)
library(leaps)

v<-c(data$percentage20_Donald_Trump<0.5)
regfit.full <- regsubsets(v~., data=data[,-1:-13], really.big = T,nvmax = 38)
reg.summary <- summary(regfit.full)
reg.summary$outmat
reg.summary$rsq
par(mfrow=c(2,2))
plot(reg.summary$rss,xlab="Number of Variables",ylab="RSS",type="l")
plot(reg.summary$adjr2,xlab="Number of Variables",ylab="Adjusted Rsq",type="l")
which.max(reg.summary$adjr2)
points(11,reg.summary$adjr2[11], col="red",cex=2,pch=20)


# Mallow's Cp with its smallest value
plot(reg.summary$cp,xlab="Number of Variables",ylab="Cp",type='l')
which.min(reg.summary$cp)
points(10,reg.summary$cp[10],col="red",cex=2,pch=20)

# BIC with its smallest value
plot(reg.summary$bic,xlab="Number of Variables",ylab="BIC",type='l')
which.min(reg.summary$bic)
points(6,reg.summary$bic[6],col="red",cex=2,pch=20)

par(mfrow=c(1,1))


par(mfrow=c(2,2))
plot(regfit.full,scale="r2")
plot(regfit.full,scale="adjr2")
plot(regfit.full,scale="Cp")

plot(regfit.full,scale="bic")
coef(regfit.full,6)
par(mfrow=c(1,1))




options(repr.plot.width = 17, repr.plot.height = 9)

# US MAP 
usa <- map_data("state")
ggplot(usa, aes(x = long, y = lat, group = group)) +
  geom_polygon(fill="lightgray", colour = "white")

abb <- data.frame(state = state.name, Abb = state.abb)
abb2<-abb
abb2$state<-tolower(abb2$state)
# TOTAL VOTES
election <- data %>% 
  group_by(state) %>% 
  summarise(votes16_Hillary_Clinton = sum(votes16_Hillary_Clinton),
            votes16_Donald_Trump = sum(votes16_Donald_Trump)) %>% 
  ungroup() %>% 
  gather(Candidate, Votes, -state) %>% 
  mutate(Party = factor(if_else(Candidate == "votes16_Hillary_Clinton", "Democrat", "Republican"))) %>% 
  left_join(abb2) %>% 
  #mutate(state = tolower(state)) %>% 
  rename("region" = state)

election2 <- election %>% 
  group_by(region, Abb) %>% 
  summarise(Votes = max(Votes)) %>% 
  ungroup() %>% 
  inner_join(election)




election2<-election2[,-2]

colnames(abb2)[1]<-"region"
colnames(election2)[1]<-"Abb"
election3<-left_join(election2,abb2)
# Left Join for creating map
usa_election <- left_join(usa, election3) %>% 
  filter(!is.na(Party))

ggplot(usa, aes(x = long, y = lat, group = group)) +
  geom_polygon(fill="lightgray", colour = "white")

# First Map
p<-ggplot(data = usa_election, aes(x = long, y = lat),color = usa_election$Party)+
  geom_polygon(aes(group = group, fill = Party),color = "gray90", size = 0.1) +
  coord_map(projection = "albers", lat0 = 39, lat1 = 45) 
p
colnames(data)


plot(Hispanic)
hist(Income[percentage20_Donald_Trump>0.5])
hist(Income[percentage20_Donald_Trump<0.5])

q=c(percentage20_Joe_Biden>0.5)

ggplot(data,aes(x=long,group=q,fill=q))+
  geom_histogram(position="dodge",binwidth=0.25)+theme_bw()

ggplot(data,aes(x=data$Asian, group=q,fill=q))+
  geom_histogram(position="identity",alpha=0.5,binwidth=1)+theme_bw()
```
