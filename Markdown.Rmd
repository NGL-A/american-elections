---
title: "Elections, COVID and Demographic Data"
author: "Bissacco, Sartori, Sboarina"
date: "27/5/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Elections, COVID and Demographic Data



Every 4 year one of the most relevant political events in the world takes place: the election of the US President. After months, even years, of preparations (campaigns, public speeches, sponsors...) the eyes of the entire world are looking to the results of those elections, to the one who will be leading the "free world" in the near future.

Our project wants to focus on what might affect one's vote: if the geographical area is relevant, if the type of work can change the preference, if one ethnicity is more likely to vote a Party over the other and if there is any strong correlation between the variables.  
We found our dataset on [Kaggle](https://www.kaggle.com/datasets/etsc9287/2020-general-election-polls). It contains 2017 demographic and economic situation of each American county, the numbers of 2016 and 2020 US Elections and COVID report until 1st November 2020 (few days before the elections).


Since it had many NA values (some counties changed name) we started by cleaning our dataset from these (we went from 4867 to 3046) and we actually got nearly to the real number of US counties which is 3142.

```{r, results='hide', message=FALSE}
library(tidyverse)
library(corrplot)
library(maps)
library(png)
library(grid)
library(cowplot)
library(statebins)
library(DT)
library(magick)
library(ISLR2)
library(leaps)
library(corrplot)

data_uncleaned <- read.csv("county_statistics.csv", sep = ",", header = TRUE)
data <- na.omit(data_uncleaned)
attach(data)
```


We also decided to remove the variables which weren't related with the others through a correlation matrix.

```{r, results='hide', warning=FALSE, message= FALSE}
names(data)[names(data) == "percentage16_Donald_Trump"] <- "pTrump16"
names(data)[names(data) == "percentage16_Hillary_Clinton"] <- "pClinton16"
names(data)[names(data) == "percentage20_Donald_Trump"] <- "pTrump20"
names(data)[names(data) == "percentage20_Joe_Biden"] <- "pBiden20"
names(data)[names(data) == "votes16_Donald_Trump"] <- "Trump16"
names(data)[names(data) == "votes16_Hillary_Clinton"] <- "Clinton16"
names(data)[names(data) == "votes20_Donald_Trump"] <- "Trump20"
names(data)[names(data) == "votes20_Joe_Biden"] <- "Biden20"
cor <- cor(data[4:51])
corrplot(cor, type = 'upper', tl.cex = 0.5)
```


We discovered that columns about transport (Drive, Carpool, Transit, Walk, Other Transp, WorkAtHome,MeanCommute), type of work (...) and some others (...) weren't relevant for our project or that they were linearly dependent with other variables (e.g. Poverty and ChildPoverty or Man, Women and TotalPop) so we decided to maintain these:  
&ensp;&ensp;1. County: county name  
&ensp;&ensp;2. State: Two-Letter State Abbreviation  
&ensp;&ensp;3. pTrump16: percentage of votes Donald Trump got in 2016  
&ensp;&ensp;4. pClinton16: percentage of votes Hilary Clinton got in 2016  
&ensp;&ensp;5. total_votes16: total number of votes in 2016  
&ensp;&ensp;6. Trump16: number of votes Donald Trump got in 2016  
&ensp;&ensp;7. Clinton16: number of votes Hilary Clinton got in 2016  
&ensp;&ensp;8. pTrump20: percentage of votes Donald Trump got in 2020  
&ensp;&ensp;9. pBiden20: percentage of votes Joe Biden got in 2020  
&ensp;&ensp;10. total_votes20: total number of votes in 2020  
&ensp;&ensp;11. Trump20: number of votes Donald Trump got in 2020  
&ensp;&ensp;12. Biden20: number of votes Joe Biden got in 2020  
&ensp;&ensp;13. lat: latitude coordinates  
&ensp;&ensp;14. long: longitude coordinates  
&ensp;&ensp;15. cases: COVID-19 cases  
&ensp;&ensp;16. deaths: COVID-19 deaths  
&ensp;&ensp;17. TotalPop: Total population  
&ensp;&ensp;18. Hispanic: percent of population that is Hispanic/Latino  
&ensp;&ensp;19. White: percent of population that is white  
&ensp;&ensp;20. Black: percent of population that is black  
&ensp;&ensp;21. Native: percent of population that is Native American or Native Alaskan  
&ensp;&ensp;22. Asian: percent of population that is Asian  
&ensp;&ensp;23. Pacific: percent of population that is Native Hawaiian or Pacific Islander  
&ensp;&ensp;24. Income: median household income  
&ensp;&ensp;25. IncomePerCap: income per capita  
&ensp;&ensp;26. Poverty: percent of population under poverty level  
&ensp;&ensp;27. Professional: percent of population employed in management, business, science and arts  
&ensp;&ensp;28. Service: percent of population employed in service jobs  
&ensp;&ensp;29. Office: percent of population employed in sales and office jobs  
&ensp;&ensp;30. Construction: percent of population employed in natural resources, construction and maintenance  
&ensp;&ensp;31. Production: percent of population employed in production, transportation and material movement  
&ensp;&ensp;32. PrivateWork: percent of population employed in private industry  
&ensp;&ensp;33. PublicWork: percent of population employed in public jobs  
&ensp;&ensp;34. SelfEmployed: percent of population self-employed  
&ensp;&ensp;35. FamilyWork: percent of population in unpaid family work  
&ensp;&ensp;36. Unemployment: unemployment rate (percent)  

```{r}
df <- data[-c(1,19:20,27,29,31,33,39:46)]
```
&ensp;&ensp;  

  
I'll declare we turned % in [0, 1]...

```{r}
df[, c(20:25,29:34,36:40)] <- (df[, c(20:25,29:34,36:40)]/100)
```
&ensp;&ensp;  


I'll add two new column with the winner of '16, '20 elections in each state.

```{r}
#Aggiungo colonne
#as.integer(as.logical(data.frame$column.name))
```
&ensp;&ensp;  

Here I think we finished to clean our data.


---------------------------------------MAPS-------------------------------------------


options(repr.plot.width = 17, repr.plot.height = 9)

prov.usa <- map_data("state")

prov.abb <- data.frame(state = state.name, Abb = state.abb)

prov.abb2<-prov.abb

prov.abb2$state<-tolower(prov.abb2$state)

prov.election <- data %>% 
  group_by(state) %>% 
  summarise(votes16_Hillary_Clinton = sum(votes16_Hillary_Clinton),
            votes16_Donald_Trump = sum(votes16_Donald_Trump)) %>% 
  ungroup() %>% 
  gather(Candidate, Votes, -state) %>% 
  mutate(Party = factor(if_else(Candidate == "votes16_Hillary_Clinton", "Democrat", "Republican"))) %>% 
  left_join(prov.abb2) %>% 
  rename("region" = state)

prov.election2 <- prov.election %>% 
  group_by(region, Abb) %>% 
  summarise(Votes = max(Votes)) %>% 
  ungroup() %>% 
  inner_join(prov.election)

prov.election2<-prov.election2[,-2]

colnames(prov.abb2)[1]<-"region"

colnames(prov.election2)[1]<-"Abb"

prov.election3<-left_join(prov.election2,prov.abb2)

prov.usa_election <- left_join(prov.usa, prov.election3) %>% 
  filter(!is.na(Party))

map.us.16<-ggplot(data = prov.usa_election, aes(x = long, y = lat),color = prov.usa_election$Party)+
  geom_polygon(aes(group = group, fill = Party),color = "gray90", size = 0.1) +
  coord_map(projection = "albers", lat0 = 39, lat1 = 45) + scale_fill_manual(values = alpha(c("blue2", "red3"), 1))

prov.abb <- data.frame(state = state.name, Abb = state.abb)

prov.abb2<-prov.abb

prov.abb2$state<-tolower(prov.abb2$state)

prov.election2020 <- data %>% 
  group_by(state) %>% 
  summarise(votes20_Joe_Biden = sum(votes20_Joe_Biden),
            votes20_Donald_Trump = sum(votes20_Donald_Trump)) %>% 
  ungroup() %>% 
  gather(Candidate, Votes, -state) %>% 
  mutate(Party = factor(if_else(Candidate == "votes20_Joe_Biden", "Democrat", "Republican"))) %>% 
  left_join(prov.abb2) %>% 
  rename("region" = state)

prov.election20202 <- prov.election2020 %>% 
  group_by(region, Abb) %>% 
  summarise(Votes = max(Votes)) %>% 
  ungroup() %>% 
  inner_join(prov.election2020)

prov.election20202<-prov.election20202[,-2]

colnames(prov.abb2)[1]<-"region"

colnames(prov.election20202)[1]<-"Abb"

prov.election20203<-left_join(prov.election20202,prov.abb2)

prov.usa_election2020 <- left_join(prov.usa, prov.election20203) %>% 
  filter(!is.na(Party))

map.us.20<-ggplot(data = prov.usa_election2020, aes(x = long, y = lat),color = prov.usa_election2020$Party)+
  geom_polygon(aes(group = group, fill = Party),color = "gray90", size = 0.1) +
  coord_map(projection = "albers", lat0 = 39, lat1 = 45) + scale_fill_manual(values = alpha(c("blue2", "red3"), 1))

prov.data2 <- data %>% 
  group_by(state) %>% 
  summarise(TotalPop = sum(TotalPop),
            Black = mean(Black),Hispanic=mean(Hispanic),Asian=mean(Asian),votes16_Hillary_Clinton = sum(votes16_Hillary_Clinton),
            votes16_Donald_Trump = sum(votes16_Donald_Trump)) %>% 
  ungroup() %>% 
  rename("region" = state)

colnames(prov.abb2)[1]<-"Abb"

colnames(prov.abb2)[2]<-"region"

prov.data3<-left_join(prov.data2,prov.abb2)

colnames(prov.data3)[1]<-"Abb"

colnames(prov.data3)[8]<-"region"

prov.usa_data <- left_join(prov.usa, prov.data3) 

map.pop<-ggplot(data = prov.usa_data, aes(x = long, y = lat),color = prov.usa_data$TotalPop)+
  geom_polygon(aes(group = group, fill = TotalPop),color = "gray90", size = 0.1) +
  coord_map(projection = "albers", lat0 = 39, lat1 = 45) +scale_fill_gradient(names<-"TotalPop", low="White", high = "deepskyblue4")

map.black<-ggplot(data = prov.usa_data, aes(x = long, y = lat),color = prov.usa_data$Black)+
  geom_polygon(aes(group = group, fill = Black),color = "gray90", size = 0.1) +
  coord_map(projection = "albers", lat0 = 39, lat1 = 45) +scale_fill_gradient(names<-"Black", low="White", high = "Black")

map.hisp<-ggplot(data = prov.usa_data, aes(x = long, y = lat),color = prov.usa_data$Hispanic)+
  geom_polygon(aes(group = group, fill = Hispanic),color = "gray90", size = 0.1) +
  coord_map(projection = "albers", lat0 = 39, lat1 = 45) +scale_fill_gradient(names<-"Hispanic", low="White", high = "coral3")

map.asian<-ggplot(data = prov.usa_data, aes(x = long, y = lat),color = prov.usa_data$Asian)+
  geom_polygon(aes(group = group, fill = Asian),color = "gray90", size = 0.1) +
  coord_map(projection = "albers", lat0 = 39, lat1 = 45) +scale_fill_gradient(names<-"Asian", low="White", high = "darkgoldenrod")

map.us.16
map.us.20
map.pop
map.black
map.hisp
map.asian
